{% extends "base.html" %}

{% block title %}TV Tracking Dashboard - FrameIQ{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-indigo-900 to-purple-900 py-8">
    <div class="container mx-auto px-4 max-w-7xl">
        <!-- Breadcrumb Navigation -->
        <div class="mb-6">
            <nav class="flex items-center gap-2 text-sm text-gray-400">
                <a href="/" class="hover:text-white transition-colors">Home</a>
                <span>‚Ä∫</span>
                <span class="text-white">TV Dashboard</span>
            </nav>
        </div>

        <!-- Quick Links -->
        <div class="flex flex-wrap gap-3 mb-8">
            <a href="/tv/my-shows" class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-white transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
                </svg>
                All My Shows
            </a>
            <a href="/tv/calendar" class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-white transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
                Full Calendar
            </a>
            <a href="/tv/upcoming" class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-white transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 001.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                Upcoming Episodes
            </a>
            <a href="/tv_shows" class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-white transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                </svg>
                Browse TV Shows
            </a>
        </div>

        <!-- Hero Header -->
        <div class="text-center mb-12 animate-fadeIn">
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-4 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400">
                üì∫ TV Tracking Dashboard
            </h1>
            <p class="text-gray-300 text-xl max-w-2xl mx-auto">
                Track your favorite shows, manage your watchlist, and never miss an episode
            </p>
        </div>

        <!-- Quick Stats -->
        <div id="quick-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
            <!-- Stats will be loaded here -->
        </div>

        <!-- Main Content Tabs -->
        <div class="mb-8">
            <div class="flex flex-wrap gap-2 justify-center mb-8">
                <button class="tab-btn active" data-tab="overview">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    Overview
                </button>
                <button class="tab-btn" data-tab="watching">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/>
                    </svg>
                    Watching
                </button>
                <button class="tab-btn" data-tab="completed">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    Completed
                </button>
                <button class="tab-btn" data-tab="plan">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                    </svg>
                    Plan to Watch
                </button>
                <button class="tab-btn" data-tab="calendar">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                    </svg>
                    Upcoming
                </button>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="overview-tab" class="tab-content active">
            <!-- Continue Watching -->
            <section class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white flex items-center gap-3">
                        <span class="text-4xl">‚ñ∂Ô∏è</span>
                        Continue Watching
                    </h2>
                    <a href="/tv/my-shows?status=watching" class="text-indigo-400 hover:text-indigo-300 text-sm font-medium">
                        View All ‚Üí
                    </a>
                </div>
                <div id="continue-watching" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    <!-- Shows will be loaded here -->
                </div>
            </section>

            <!-- Recently Completed -->
            <section class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white flex items-center gap-3">
                        <span class="text-4xl">‚úÖ</span>
                        Recently Completed
                    </h2>
                    <a href="/tv/my-shows?status=completed" class="text-indigo-400 hover:text-indigo-300 text-sm font-medium">
                        View All ‚Üí
                    </a>
                </div>
                <div id="recently-completed" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    <!-- Shows will be loaded here -->
                </div>
            </section>

            <!-- Upcoming This Week -->
            <section>
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-white flex items-center gap-3">
                        <span class="text-4xl">üìÖ</span>
                        Upcoming This Week
                    </h2>
                    <a href="/tv/calendar" class="text-indigo-400 hover:text-indigo-300 text-sm font-medium">
                        Full Calendar ‚Üí
                    </a>
                </div>
                <div id="upcoming-week" class="space-y-3">
                    <!-- Episodes will be loaded here -->
                </div>
            </section>
        </div>

        <div id="watching-tab" class="tab-content hidden">
            <div id="watching-shows" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Shows will be loaded here -->
            </div>
        </div>

        <div id="completed-tab" class="tab-content hidden">
            <div id="completed-shows" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Shows will be loaded here -->
            </div>
        </div>

        <div id="plan-tab" class="tab-content hidden">
            <div id="plan-shows" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Shows will be loaded here -->
            </div>
        </div>

        <div id="calendar-tab" class="tab-content hidden">
            <div id="calendar-view">
                <!-- Calendar will be loaded here -->
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-20">
            <div class="text-8xl mb-6">üì∫</div>
            <h3 class="text-3xl font-bold text-white mb-4">Start Tracking TV Shows</h3>
            <p class="text-gray-400 text-lg mb-8 max-w-md mx-auto">
                Track your progress, get notifications for new episodes, and organize your watchlist
            </p>
            <a href="/tv_shows" class="inline-block px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold rounded-xl transition-all transform hover:scale-105 shadow-2xl">
                üîç Browse TV Shows
            </a>
        </div>
    </div>
</div>

<style>
.tab-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    color: #9ca3af;
    border-radius: 0.75rem;
    font-weight: 600;
    transition: all 0.2s;
    border: 1px solid transparent;
}
.tab-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}
.tab-btn.active {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}
.tab-content {
    animation: fadeIn 0.3s ease-in;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
.stat-card {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    padding: 1.5rem;
    transition: all 0.3s;
}
.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
}
.show-card-mini {
    position: relative;
    border-radius: 0.75rem;
    overflow: hidden;
    transition: all 0.3s;
    cursor: pointer;
}
.show-card-mini:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
}
.show-card-mini img {
    width: 100%;
    aspect-ratio: 2/3;
    object-fit: cover;
}
.show-card-mini .overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    padding: 1rem;
}
</style>

<script>
const TMDB_API_KEY = '{{ api_key }}';
let allShows = [];

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        btn.classList.add('active');
        document.getElementById(`${btn.dataset.tab}-tab`).classList.remove('hidden');
        
        if (btn.dataset.tab === 'calendar') {
            loadCalendarView();
        }
    });
});

async function loadDashboard() {
    try {
        // Load all shows
        const response = await fetch('/api/tv/my-shows');
        const data = await response.json();
        allShows = data.shows || [];
        
        if (allShows.length === 0) {
            document.getElementById('empty-state').classList.remove('hidden');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            return;
        }
        
        // Calculate stats
        displayQuickStats(allShows);
        
        // Load sections
        await loadContinueWatching(allShows);
        await loadRecentlyCompleted(allShows);
        await loadUpcomingWeek();
        
        // Load tab-specific content
        loadByStatus('watching');
        loadByStatus('completed');
        loadByStatus('plan_to_watch');
        
    } catch (error) {
        console.error('Error loading dashboard:', error);
    }
}

function displayQuickStats(shows) {
    const watching = shows.filter(s => s.status === 'watching').length;
    const completed = shows.filter(s => s.status === 'completed').length;
    const planToWatch = shows.filter(s => s.status === 'plan_to_watch').length;
    const totalEpisodes = shows.reduce((sum, s) => sum + s.watched_episodes, 0);
    
    const statsHTML = `
        <div class="stat-card">
            <div class="text-green-400 text-3xl mb-2">‚ñ∂Ô∏è</div>
            <div class="text-white text-3xl font-bold">${watching}</div>
            <div class="text-gray-400 text-sm">Watching</div>
        </div>
        <div class="stat-card">
            <div class="text-blue-400 text-3xl mb-2">‚úÖ</div>
            <div class="text-white text-3xl font-bold">${completed}</div>
            <div class="text-gray-400 text-sm">Completed</div>
        </div>
        <div class="stat-card">
            <div class="text-yellow-400 text-3xl mb-2">üìã</div>
            <div class="text-white text-3xl font-bold">${planToWatch}</div>
            <div class="text-gray-400 text-sm">Plan to Watch</div>
        </div>
        <div class="stat-card">
            <div class="text-purple-400 text-3xl mb-2">üì∫</div>
            <div class="text-white text-3xl font-bold">${totalEpisodes}</div>
            <div class="text-gray-400 text-sm">Episodes Watched</div>
        </div>
    `;
    document.getElementById('quick-stats').innerHTML = statsHTML;
}

async function loadContinueWatching(shows) {
    const watching = shows.filter(s => s.status === 'watching')
        .sort((a, b) => new Date(b.last_watched) - new Date(a.last_watched))
        .slice(0, 5);
    
    const container = document.getElementById('continue-watching');
    
    if (watching.length === 0) {
        container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-8">No shows currently watching</p>';
        return;
    }
    
    container.innerHTML = '';
    for (const show of watching) {
        const showDetails = await fetchShowDetails(show.show_id);
        container.innerHTML += renderShowCard(show, showDetails);
    }
}

async function loadRecentlyCompleted(shows) {
    const completed = shows.filter(s => s.status === 'completed' && s.completed_at)
        .sort((a, b) => new Date(b.completed_at) - new Date(a.completed_at))
        .slice(0, 5);
    
    const container = document.getElementById('recently-completed');
    
    if (completed.length === 0) {
        container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-8">No completed shows yet</p>';
        return;
    }
    
    container.innerHTML = '';
    for (const show of completed) {
        const showDetails = await fetchShowDetails(show.show_id);
        container.innerHTML += renderShowCard(show, showDetails);
    }
}

async function loadUpcomingWeek() {
    try {
        const response = await fetch('/api/tv/upcoming-episodes');
        const data = await response.json();
        const episodes = data.episodes || [];
        
        const container = document.getElementById('upcoming-week');
        
        if (episodes.length === 0) {
            container.innerHTML = '<p class="text-gray-400 text-center py-8 bg-white/5 rounded-xl">No upcoming episodes this week</p>';
            return;
        }
        
        container.innerHTML = episodes.slice(0, 10).map(ep => `
            <div class="bg-white/5 hover:bg-white/10 rounded-xl p-4 flex items-center gap-4 transition-all cursor-pointer"
                 onclick="window.location.href='/tv/${ep.show_id}'">
                <img src="https://image.tmdb.org/t/p/w200${ep.still_path || ep.poster_path}" 
                     alt="${ep.show_name}"
                     class="w-24 h-14 rounded object-cover"
                     onerror="this.src='/static/images/no-image.png'">
                <div class="flex-1">
                    <div class="text-white font-semibold">${ep.show_name}</div>
                    <div class="text-sm text-indigo-300">S${ep.season_number}E${ep.episode_number} ‚Ä¢ ${ep.episode_name || 'TBA'}</div>
                </div>
                <div class="text-right">
                    <div class="text-white font-semibold">${formatDate(ep.air_date)}</div>
                    <div class="text-xs text-gray-400">${ep.days_until_air} days</div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading upcoming:', error);
    }
}

async function loadByStatus(status) {
    const shows = allShows.filter(s => s.status === status);
    const containerId = status === 'plan_to_watch' ? 'plan-shows' : `${status}-shows`;
    const container = document.getElementById(containerId);
    
    if (shows.length === 0) {
        container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-12">No shows in this category</p>';
        return;
    }
    
    container.innerHTML = '';
    for (const show of shows) {
        const showDetails = await fetchShowDetails(show.show_id);
        container.innerHTML += renderShowCardLarge(show, showDetails);
    }
}

async function fetchShowDetails(showId) {
    try {
        const response = await fetch(`https://api.themoviedb.org/3/tv/${showId}?api_key=${TMDB_API_KEY}`);
        return await response.json();
    } catch (error) {
        console.error('Error fetching show details:', error);
        return { name: 'Unknown Show', poster_path: null };
    }
}

function renderShowCard(show, details) {
    return `
        <div class="show-card-mini" onclick="window.location.href='/tv/${show.show_id}'">
            <img src="https://image.tmdb.org/t/p/w300${details.poster_path}" 
                 alt="${details.name}"
                 onerror="this.src='/static/images/no-poster.png'">
            <div class="overlay">
                <div class="text-white font-semibold text-sm truncate">${details.name}</div>
                <div class="text-xs text-indigo-300">${show.watched_episodes}/${show.total_episodes} episodes</div>
            </div>
        </div>
    `;
}

function renderShowCardLarge(show, details) {
    const statusColors = {
        'watching': 'bg-green-500',
        'completed': 'bg-blue-500',
        'plan_to_watch': 'bg-yellow-500',
        'dropped': 'bg-red-500'
    };
    
    return `
        <div class="bg-white/5 rounded-xl overflow-hidden hover:bg-white/10 transition-all cursor-pointer"
             onclick="window.location.href='/tv/${show.show_id}'">
            <img src="https://image.tmdb.org/t/p/w300${details.poster_path}" 
                 alt="${details.name}"
                 class="w-full aspect-[2/3] object-cover"
                 onerror="this.src='/static/images/no-poster.png'">
            <div class="p-4">
                <h3 class="text-white font-semibold mb-2 truncate">${details.name}</h3>
                <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-400">${show.watched_episodes}/${show.total_episodes} eps</span>
                    <span class="text-indigo-300">${show.progress_percentage}%</span>
                </div>
                <div class="h-1.5 bg-gray-700 rounded-full overflow-hidden">
                    <div class="${statusColors[show.status]} h-full" style="width: ${show.progress_percentage}%"></div>
                </div>
            </div>
        </div>
    `;
}

async function loadCalendarView() {
    const container = document.getElementById('calendar-view');
    container.innerHTML = '<div class="flex justify-center items-center py-12"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"></div></div>';
    
    try {
        const response = await fetch('/api/tv/upcoming-episodes');
        const data = await response.json();
        
        if (!data.episodes || data.episodes.length === 0) {
            container.innerHTML = `
                <div class="text-center py-20">
                    <div class="text-6xl mb-4">üìÖ</div>
                    <h3 class="text-2xl font-bold text-white mb-3">No Upcoming Episodes</h3>
                    <p class="text-gray-400 mb-6">
                        No episodes scheduled in the next 7 days for your tracked shows.
                    </p>
                    <a href="/tv/upcoming" class="inline-block px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-all">
                        View Full Calendar
                    </a>
                </div>
            `;
            return;
        }
        
        // Group by date
        const byDate = {};
        data.episodes.forEach(ep => {
            if (!byDate[ep.air_date]) {
                byDate[ep.air_date] = [];
            }
            byDate[ep.air_date].push(ep);
        });
        
        let html = '<div class="space-y-8">';
        Object.entries(byDate).sort().forEach(([date, episodes]) => {
            html += `
                <div>
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-indigo-400">${formatDate(date)}</span>
                        <span class="text-gray-500 text-sm font-normal">${date}</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;
            
            episodes.forEach(ep => {
                const stillUrl = ep.still_path || ep.poster_path || '/static/images/no-poster.png';
                html += `
                    <div class="bg-white/5 rounded-lg overflow-hidden hover:bg-white/10 transition-all cursor-pointer"
                         onclick="window.location.href='/tv/${ep.show_id}'">
                        <img src="${stillUrl}" 
                             alt="${ep.show_name} - ${ep.episode_name}"
                             class="w-full aspect-video object-cover"
                             onerror="this.src='/static/images/no-poster.png'">
                        <div class="p-4">
                            <h4 class="text-white font-semibold mb-1">${ep.show_name}</h4>
                            <p class="text-sm text-indigo-300 mb-2">S${ep.season_number}E${ep.episode_number}: ${ep.episode_name || 'Episode ' + ep.episode_number}</p>
                            ${ep.episode_overview ? `<p class="text-xs text-gray-400 line-clamp-2">${ep.episode_overview}</p>` : ''}
                            <div class="mt-3 flex justify-between items-center">
                                <span class="text-xs ${ep.watched ? 'text-green-400' : 'text-gray-400'}">
                                    ${ep.watched ? '‚úì Watched' : 'Not watched'}
                                </span>
                                <span class="text-xs text-indigo-400">${ep.days_until_air} days</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div></div>';
        });
        
        html += '</div>';
        html += `
            <div class="text-center mt-8">
                <a href="/tv/upcoming" class="inline-block px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-all">
                    View Full Calendar (All Upcoming Episodes)
                </a>
            </div>
        `;
        
        container.innerHTML = html;
    } catch (error) {
        console.error('Error loading calendar:', error);
        container.innerHTML = `
            <div class="text-center py-12">
                <p class="text-red-400 mb-4">Error loading upcoming episodes</p>
                <a href="/tv/upcoming" class="text-indigo-400 hover:text-indigo-300">View full calendar page</a>
            </div>
        `;
    }
}

function formatDate(dateStr) {
    const date = new Date(dateStr);
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    if (date.toDateString() === today.toDateString()) return 'Today';
    if (date.toDateString() === tomorrow.toDateString()) return 'Tomorrow';
    
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Load dashboard on page load
loadDashboard();
</script>
{% endblock %}
